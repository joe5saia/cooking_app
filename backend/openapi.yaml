openapi: 3.0.3
info:
  title: Cooking App API
  version: 1.0.0
  description: v1 REST API for the Cooking App MVP.
servers:
  - url: /
tags:
  - name: health
  - name: auth
  - name: tokens
  - name: users
  - name: recipe-books
  - name: tags
  - name: aisles
  - name: items
  - name: shopping-lists
  - name: meal-plans
  - name: recipes
paths:
  /api/v1/healthz:
    get:
      tags: [health]
      summary: Health check
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                required: [ok]
  /api/v1/auth/login:
    post:
      tags: [auth]
      summary: Login (creates session)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "204":
          description: Logged in
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "429":
          $ref: "#/components/responses/Problem429"
        "500":
          $ref: "#/components/responses/Problem500"
  /api/v1/auth/logout:
    post:
      tags: [auth]
      summary: Logout (clears session)
      description: Clears the session cookie. When authenticated via bearer token, this endpoint does not revoke the token; revoke via `DELETE /api/v1/tokens/{id}`.
      responses:
        "204":
          description: Logged out
        "401":
          $ref: "#/components/responses/Problem401"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/auth/me:
    get:
      tags: [auth]
      summary: Current user
      description: Returns the currently authenticated user (session cookie or bearer token).
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MeResponse"
        "401":
          $ref: "#/components/responses/Problem401"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/tokens:
    get:
      tags: [tokens]
      summary: List Personal Access Tokens (no secrets)
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Token"
        "401":
          $ref: "#/components/responses/Problem401"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
    post:
      tags: [tokens]
      summary: Create Personal Access Token (secret returned once)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTokenRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateTokenResponse"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "429":
          $ref: "#/components/responses/Problem429"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/tokens/{id}:
    delete:
      tags: [tokens]
      summary: Revoke Personal Access Token
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      responses:
        "204":
          description: Revoked
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/users:
    get:
      tags: [users]
      summary: List users
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
        "401":
          $ref: "#/components/responses/Problem401"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
    post:
      tags: [users]
      summary: Create user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateUserRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/users/{id}/deactivate:
    put:
      tags: [users]
      summary: Deactivate user
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      responses:
        "204":
          description: Deactivated
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/recipe-books:
    get:
      tags: [recipe-books]
      summary: List recipe books
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/RecipeBook"
        "401":
          $ref: "#/components/responses/Problem401"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
    post:
      tags: [recipe-books]
      summary: Create recipe book
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateRecipeBookRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecipeBook"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/recipe-books/{id}:
    put:
      tags: [recipe-books]
      summary: Update recipe book
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateRecipeBookRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecipeBook"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
    delete:
      tags: [recipe-books]
      summary: Delete recipe book
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      responses:
        "204":
          description: Deleted
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "409":
          $ref: "#/components/responses/Problem409"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/tags:
    get:
      tags: [tags]
      summary: List tags
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Tag"
        "401":
          $ref: "#/components/responses/Problem401"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
    post:
      tags: [tags]
      summary: Create tag
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTagRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Tag"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/tags/{id}:
    put:
      tags: [tags]
      summary: Update tag
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTagRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Tag"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
    delete:
      tags: [tags]
      summary: Delete tag
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      responses:
        "204":
          description: Deleted
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/aisles:
    get:
      tags: [aisles]
      summary: List grocery aisles
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/GroceryAisle"
        "401":
          $ref: "#/components/responses/Problem401"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
    post:
      tags: [aisles]
      summary: Create grocery aisle
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateGroceryAisleRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GroceryAisle"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/aisles/{id}:
    get:
      tags: [aisles]
      summary: Get grocery aisle
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GroceryAisle"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
    put:
      tags: [aisles]
      summary: Update grocery aisle
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateGroceryAisleRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GroceryAisle"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
    delete:
      tags: [aisles]
      summary: Delete grocery aisle
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      responses:
        "204":
          description: Deleted
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/items:
    get:
      tags: [items]
      summary: List items
      parameters:
        - name: q
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Item"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
    post:
      tags: [items]
      summary: Create item
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateItemRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Item"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/items/{id}:
    get:
      tags: [items]
      summary: Get item
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Item"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
    put:
      tags: [items]
      summary: Update item
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateItemRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Item"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
    delete:
      tags: [items]
      summary: Delete item
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      responses:
        "204":
          description: Deleted
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/shopping-lists:
    get:
      tags: [shopping-lists]
      summary: List shopping lists
      parameters:
        - name: start
          in: query
          required: true
          schema:
            type: string
            format: date
        - name: end
          in: query
          required: true
          schema:
            type: string
            format: date
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ShoppingList"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
    post:
      tags: [shopping-lists]
      summary: Create shopping list
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateShoppingListRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ShoppingList"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/shopping-lists/{id}:
    get:
      tags: [shopping-lists]
      summary: Get shopping list
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ShoppingListDetail"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
    put:
      tags: [shopping-lists]
      summary: Update shopping list
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateShoppingListRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ShoppingList"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
    delete:
      tags: [shopping-lists]
      summary: Delete shopping list
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      responses:
        "204":
          description: Deleted
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/shopping-lists/{id}/items:
    get:
      tags: [shopping-lists]
      summary: List shopping list items
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ShoppingListItem"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
    post:
      tags: [shopping-lists]
      summary: Add items to shopping list
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ShoppingListAddItemsRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ShoppingListItem"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/shopping-lists/{id}/items/from-recipes:
    post:
      tags: [shopping-lists]
      summary: Add recipe items to shopping list
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ShoppingListAddRecipesRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ShoppingListItem"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/shopping-lists/{id}/items/from-meal-plan:
    post:
      tags: [shopping-lists]
      summary: Add meal plan items to shopping list
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ShoppingListAddMealPlanRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ShoppingListItem"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/shopping-lists/{id}/items/{item_id}:
    patch:
      tags: [shopping-lists]
      summary: Update shopping list item purchase state
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
        - $ref: "#/components/parameters/ShoppingListItemIDParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ShoppingListItemPurchaseRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ShoppingListItem"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
    delete:
      tags: [shopping-lists]
      summary: Remove shopping list item
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
        - $ref: "#/components/parameters/ShoppingListItemIDParam"
      responses:
        "204":
          description: Deleted
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/meal-plans:
    get:
      tags: [meal-plans]
      summary: List meal plan entries
      parameters:
        - name: start
          in: query
          required: true
          schema:
            type: string
            format: date
        - name: end
          in: query
          required: true
          schema:
            type: string
            format: date
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MealPlanListResponse"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
    post:
      tags: [meal-plans]
      summary: Add recipe to meal plan
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateMealPlanRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MealPlanEntry"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "409":
          $ref: "#/components/responses/Problem409"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/meal-plans/{date}/{recipe_id}:
    delete:
      tags: [meal-plans]
      summary: Remove recipe from meal plan
      parameters:
        - $ref: "#/components/parameters/DateParam"
        - $ref: "#/components/parameters/RecipeIDParam"
      responses:
        "204":
          description: Removed
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/recipes:
    get:
      tags: [recipes]
      summary: List recipes
      parameters:
        - name: q
          in: query
          schema: { type: string }
        - name: book_id
          in: query
          schema: { type: string, format: uuid }
        - name: tag_id
          in: query
          schema: { type: string, format: uuid }
        - name: include_deleted
          in: query
          schema: { type: boolean }
        - name: limit
          in: query
          schema: { type: integer, minimum: 1, maximum: 200 }
        - name: cursor
          in: query
          schema: { type: string }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecipeListResponse"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
    post:
      tags: [recipes]
      summary: Create recipe
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RecipeUpsertRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecipeDetail"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/recipes/{id}:
    get:
      tags: [recipes]
      summary: Get recipe detail
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecipeDetail"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
    put:
      tags: [recipes]
      summary: Update recipe (replace semantics)
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RecipeUpsertRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RecipeDetail"
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "409":
          $ref: "#/components/responses/Problem409"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
    delete:
      tags: [recipes]
      summary: Soft delete recipe
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      responses:
        "204":
          description: Deleted
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
  /api/v1/recipes/{id}/restore:
    put:
      tags: [recipes]
      summary: Restore soft-deleted recipe
      parameters:
        - $ref: "#/components/parameters/UUIDParam"
      responses:
        "204":
          description: Restored
        "400":
          $ref: "#/components/responses/Problem400"
        "401":
          $ref: "#/components/responses/Problem401"
        "404":
          $ref: "#/components/responses/Problem404"
        "500":
          $ref: "#/components/responses/Problem500"
      security:
        - cookieAuth: []
        - bearerAuth: []
components:
  parameters:
    UUIDParam:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
    DateParam:
      name: date
      in: path
      required: true
      schema:
        type: string
        format: date
    RecipeIDParam:
      name: recipe_id
      in: path
      required: true
      schema:
        type: string
        format: uuid
    ShoppingListItemIDParam:
      name: item_id
      in: path
      required: true
      schema:
        type: string
        format: uuid
  responses:
    Problem400:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Problem"
    Problem401:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Problem"
    Problem404:
      description: Not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Problem"
    Problem409:
      description: Conflict
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Problem"
    Problem500:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Problem"
    Problem429:
      description: Too many requests
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Problem"
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: cooking_app_session
    bearerAuth:
      type: http
      scheme: bearer
  schemas:
    Problem:
      type: object
      properties:
        code:
          type: string
          description: Stable machine-readable error code.
          enum:
            - bad_request
            - request_too_large
            - validation_error
            - unauthorized
            - forbidden
            - not_found
            - conflict
            - rate_limited
            - method_not_allowed
            - internal_error
        message: { type: string }
        details:
          description: Present only for `validation_error` as a list of field-level errors.
          type: array
          items:
            $ref: "#/components/schemas/FieldError"
          nullable: true
      required: [code, message]
    FieldError:
      type: object
      properties:
        field: { type: string }
        message: { type: string }
      required: [field, message]
    LoginRequest:
      type: object
      properties:
        username: { type: string }
        password: { type: string }
      required: [username, password]
    MeResponse:
      type: object
      properties:
        id: { type: string, format: uuid }
        username: { type: string }
        display_name:
          type: string
          nullable: true
      required: [id, username, display_name]
    Token:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        created_at: { type: string, format: date-time }
        last_used_at:
          type: string
          format: date-time
          nullable: true
        expires_at:
          type: string
          format: date-time
          nullable: true
      required: [id, name, created_at, last_used_at, expires_at]
    CreateTokenRequest:
      type: object
      properties:
        name: { type: string }
        expires_at: { type: string, format: date-time }
      required: [name]
    CreateTokenResponse:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        token: { type: string }
        created_at: { type: string, format: date-time }
      required: [id, name, token, created_at]
    User:
      type: object
      properties:
        id: { type: string, format: uuid }
        username: { type: string }
        display_name:
          type: string
          nullable: true
        is_active: { type: boolean }
        created_at: { type: string, format: date-time }
      required: [id, username, display_name, is_active, created_at]
    CreateUserRequest:
      type: object
      properties:
        username: { type: string }
        password: { type: string }
        display_name:
          type: string
          nullable: true
      required: [username, password]
    RecipeBook:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        created_at: { type: string, format: date-time }
      required: [id, name, created_at]
    CreateRecipeBookRequest:
      type: object
      properties:
        name: { type: string }
      required: [name]
    Tag:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        created_at: { type: string, format: date-time }
      required: [id, name, created_at]
    CreateTagRequest:
      type: object
      properties:
        name: { type: string }
      required: [name]
    CreateGroceryAisleRequest:
      type: object
      properties:
        name: { type: string }
        sort_group: { type: integer }
        sort_order: { type: integer }
        numeric_value:
          type: integer
          nullable: true
      required: [name, sort_group, sort_order]
    CreateItemRequest:
      type: object
      properties:
        name: { type: string }
        store_url:
          type: string
          nullable: true
        aisle_id:
          type: string
          format: uuid
          nullable: true
      required: [name]
    CreateShoppingListRequest:
      type: object
      properties:
        list_date: { type: string, format: date }
        name: { type: string }
        notes:
          type: string
          nullable: true
      required: [list_date, name]
    ShoppingList:
      type: object
      properties:
        id: { type: string, format: uuid }
        list_date: { type: string, format: date }
        name: { type: string }
        notes:
          type: string
          nullable: true
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }
      required: [id, list_date, name, notes, created_at, updated_at]
    ShoppingListDetail:
      type: object
      properties:
        id: { type: string, format: uuid }
        list_date: { type: string, format: date }
        name: { type: string }
        notes:
          type: string
          nullable: true
        items:
          type: array
          items:
            $ref: "#/components/schemas/ShoppingListItem"
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }
      required: [id, list_date, name, notes, items, created_at, updated_at]
    ShoppingListItem:
      type: object
      properties:
        id: { type: string, format: uuid }
        item:
          $ref: "#/components/schemas/Item"
        quantity:
          type: number
          nullable: true
        quantity_text:
          type: string
          nullable: true
        unit:
          type: string
          nullable: true
        is_purchased: { type: boolean }
        purchased_at:
          type: string
          format: date-time
          nullable: true
      required: [id, item, quantity, quantity_text, unit, is_purchased, purchased_at]
    ShoppingListItemInput:
      type: object
      properties:
        item_id: { type: string, format: uuid }
        quantity:
          type: number
          nullable: true
        quantity_text:
          type: string
          nullable: true
        unit:
          type: string
          nullable: true
      required: [item_id]
    ShoppingListAddItemsRequest:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/ShoppingListItemInput"
      required: [items]
    ShoppingListAddRecipesRequest:
      type: object
      properties:
        recipe_ids:
          type: array
          items: { type: string, format: uuid }
      required: [recipe_ids]
    ShoppingListAddMealPlanRequest:
      type: object
      properties:
        date: { type: string, format: date }
      required: [date]
    ShoppingListItemPurchaseRequest:
      type: object
      properties:
        is_purchased: { type: boolean }
      required: [is_purchased]
    MealPlanRecipe:
      type: object
      properties:
        id: { type: string, format: uuid }
        title: { type: string }
      required: [id, title]
    MealPlanEntry:
      type: object
      properties:
        date: { type: string, format: date }
        recipe:
          $ref: "#/components/schemas/MealPlanRecipe"
      required: [date, recipe]
    MealPlanListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/MealPlanEntry"
      required: [items]
    CreateMealPlanRequest:
      type: object
      properties:
        date: { type: string, format: date }
        recipe_id: { type: string, format: uuid }
      required: [date, recipe_id]
    RecipeTag:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
      required: [id, name]
    RecipeListItem:
      type: object
      properties:
        id: { type: string, format: uuid }
        title: { type: string }
        servings: { type: integer }
        prep_time_minutes: { type: integer }
        total_time_minutes: { type: integer }
        source_url:
          type: string
          nullable: true
        notes:
          type: string
          nullable: true
        recipe_book_id:
          type: string
          format: uuid
          nullable: true
        tags:
          type: array
          items:
            $ref: "#/components/schemas/RecipeTag"
        deleted_at:
          type: string
          format: date-time
          nullable: true
        updated_at: { type: string, format: date-time }
      required:
        [
          id,
          title,
          servings,
          prep_time_minutes,
          total_time_minutes,
          source_url,
          notes,
          recipe_book_id,
          tags,
          deleted_at,
          updated_at,
        ]
    RecipeListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/RecipeListItem"
        next_cursor:
          type: string
          nullable: true
      required: [items, next_cursor]
    GroceryAisle:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        sort_group: { type: integer }
        sort_order: { type: integer }
        numeric_value:
          type: integer
          nullable: true
      required: [id, name, sort_group, sort_order, numeric_value]
    Item:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        store_url:
          type: string
          nullable: true
        aisle:
          $ref: "#/components/schemas/GroceryAisle"
          nullable: true
      required: [id, name, store_url, aisle]
    RecipeIngredient:
      type: object
      properties:
        id: { type: string, format: uuid }
        position: { type: integer }
        quantity:
          type: number
          nullable: true
        quantity_text:
          type: string
          nullable: true
        unit:
          type: string
          nullable: true
        item:
          $ref: "#/components/schemas/Item"
        prep:
          type: string
          nullable: true
        notes:
          type: string
          nullable: true
        original_text:
          type: string
          nullable: true
      required: [id, position, quantity, quantity_text, unit, item, prep, notes, original_text]
    RecipeStep:
      type: object
      properties:
        id: { type: string, format: uuid }
        step_number: { type: integer }
        instruction: { type: string }
      required: [id, step_number, instruction]
    RecipeDetail:
      allOf:
        - $ref: "#/components/schemas/RecipeListItem"
        - type: object
          properties:
            ingredients:
              type: array
              items:
                $ref: "#/components/schemas/RecipeIngredient"
            steps:
              type: array
              items:
                $ref: "#/components/schemas/RecipeStep"
            created_at: { type: string, format: date-time }
            created_by: { type: string, format: uuid }
            updated_by: { type: string, format: uuid }
            deleted_at:
              type: string
              format: date-time
              nullable: true
          required: [ingredients, steps, created_at, created_by, updated_by, deleted_at]
    RecipeUpsertRequest:
      type: object
      properties:
        title: { type: string }
        servings: { type: integer }
        prep_time_minutes: { type: integer }
        total_time_minutes: { type: integer }
        source_url:
          type: string
          nullable: true
        notes:
          type: string
          nullable: true
        recipe_book_id:
          type: string
          format: uuid
          nullable: true
        tag_ids:
          type: array
          items: { type: string, format: uuid }
        ingredients:
          type: array
          items:
            $ref: "#/components/schemas/RecipeIngredientUpsert"
        steps:
          type: array
          items:
            $ref: "#/components/schemas/RecipeStepUpsert"
      required:
        [title, servings, prep_time_minutes, total_time_minutes, recipe_book_id, tag_ids, ingredients, steps]
    RecipeIngredientUpsert:
      type: object
      properties:
        position: { type: integer }
        quantity:
          type: number
          nullable: true
        quantity_text:
          type: string
          nullable: true
        unit:
          type: string
          nullable: true
        item_id:
          type: string
          format: uuid
          nullable: true
        item_name:
          type: string
          nullable: true
        prep:
          type: string
          nullable: true
        notes:
          type: string
          nullable: true
        original_text:
          type: string
          nullable: true
      required: [position, quantity, quantity_text, unit, item_id, item_name, prep, notes, original_text]
    RecipeStepUpsert:
      type: object
      properties:
        step_number: { type: integer }
        instruction: { type: string }
      required: [step_number, instruction]
